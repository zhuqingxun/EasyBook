---
description: "产品需求文档: 电子书聚合搜索平台"
status: archived
created_at: 2026-02-06T08:13:49
updated_at: 2026-02-06T21:50:00
archived_at: 2026-02-06T21:50:00
---

# 电子书聚合搜索平台 - 产品需求文档

## 1. 执行摘要

EasyBook 是一个电子书聚合搜索平台，为用户提供统一的电子书检索入口。平台汇聚 Anna's Archive、Z-Library 等开源元数据库的书籍信息，用户通过关键词搜索即可找到所需电子书，并通过 IPFS 去中心化网络获取可靠的下载链接。

当前电子书资源分散在众多网站，用户查找一本书往往需要辗转多个站点，且经常遇到下载链接失效的问题。EasyBook 通过"静态索引入库 + IPFS 内容寻址交付"的策略，从根本上解决资源分散和死链两大痛点。

MVP 目标：搭建一个可用的 Web 搜索界面，导入中文电子书元数据，实现基于书名和作者的关键词搜索，并提供经过可用性检测的 IPFS 下载链接。

## 2. 使命

**产品使命**：让每一个人都能快速、可靠地找到并下载所需的电子书。

**核心原则：**

1. **搜索即所得** — 用户搜索后直接看到可下载的结果，不需要二次跳转到其他平台搜索
2. **链接可靠** — 通过 IPFS 内容寻址和定期检测，确保展示的下载链接真实可用
3. **零门槛使用** — 无需注册、无需登录，打开即搜，点击即下
4. **中文优先** — 优先保障中文书籍的搜索体验，包括中文分词和简繁体兼容
5. **简洁高效** — 界面聚焦于搜索和下载核心功能，不做无关的信息堆砌

## 3. 目标用户

### 主要用户画像

| 维度 | 描述 |
| --- | --- |
| **角色** | 任何需要搜索和下载电子书的互联网用户 |
| **语言偏好** | 以中文读者为主 |
| **技术水平** | 普通互联网用户，会使用浏览器和搜索引擎 |
| **设备** | 主要通过 PC 浏览器访问 |

### 关键需求和痛点

- **资源分散**：想找一本书需要在多个网站逐个搜索，耗时耗力
- **死链频发**：好不容易找到下载链接，点进去发现已经失效
- **格式不明**：不清楚哪些网站提供自己阅读器支持的格式（EPUB/PDF/MOBI/AZW3）
- **体验差异大**：不同电子书网站的界面和操作方式各异，学习成本高

## 4. MVP 范围

### 核心功能

- ✅ 关键词搜索（书名 + 作者模糊匹配）
- ✅ 搜索结果列表展示（书名、作者、格式、文件大小、下载按钮）
- ✅ 同一本书多格式合并展示
- ✅ IPFS 网关下载链接生成（智能选优）
- ✅ 搜索结果传统分页（每页 20 条）
- ✅ 搜索无结果提示

### 数据与后台

- ✅ 元数据 Dumps 离线 ETL 导入（Anna's Archive / Z-Lib）
- ✅ 数据清洗：过滤非电子书格式，过滤无 MD5 条目，仅保留中文和英文记录（无 CID 的记录仍导入，但前端不显示下载按钮）
- ✅ 基于 MD5 的数据去重
- ✅ 中文简繁体统一索引
- ✅ IPFS 链接定期可用性检测（后台定时任务）
- ✅ 多 IPFS 网关响应速度检测与智能选优

### 明确不做

- ❌ 用户注册 / 登录 / 账户体系
- ❌ 分类浏览导航
- ❌ 书籍详情页（封面、简介、目录）
- ❌ 用户提交/分享资源
- ❌ 服务器代下载
- ❌ 移动端适配
- ❌ 实时爬取外部网站
- ❌ 评论 / 评分 / 收藏功能
- ❌ 国际化多语言界面

## 5. 用户故事

### 搜索相关

**US-1: 按书名搜索**
> 作为一个读者，我想要输入书名关键词进行搜索，以便快速找到我想要的电子书。

示例：用户在搜索框输入"三体"，按回车，页面展示所有书名包含"三体"的电子书结果列表。

**US-2: 按作者搜索**
> 作为一个读者，我想要输入作者名搜索，以便找到某个作者的所有电子书。

示例：用户输入"刘慈欣"，搜索结果展示该作者的所有可用电子书。

**US-3: 浏览搜索结果**
> 作为一个读者，我想要在搜索结果中看到书名、作者、可用格式和文件大小，以便快速判断哪本书是我需要的。

示例：搜索结果列表每条展示：书名、作者、格式标签（如 `EPUB` `PDF`）、文件大小（如 `2.3 MB`）。

**US-4: 翻页浏览**
> 作为一个读者，当搜索结果很多时，我想要翻页浏览，以便逐步查看所有匹配结果。

示例：搜索"Python"返回 500 条结果，底部显示页码导航，每页 20 条。

### 下载相关

**US-5: 选择格式下载**
> 作为一个读者，我想要看到同一本书的所有可用格式，并选择我需要的格式下载，以便在我的阅读器上使用。

示例：搜索到《三体》，看到 `EPUB` 和 `PDF` 两个格式按钮，点击 `EPUB` 后在新窗口打开 IPFS 下载链接。

**US-6: 获得可靠的下载链接**
> 作为一个读者，我希望点击的下载链接是可用的，以便不浪费时间在失效链接上。

示例：后台已检测到某 CID 在 ipfs.io 网关不可用但 dweb.link 可用，点击下载时自动使用可用的网关。

### 技术用户故事

**US-7: 数据导入**
> 作为一个运维人员，我想要通过脚本导入 Anna's Archive 元数据 Dumps，以便为搜索引擎提供书籍数据。

示例：执行 ETL 脚本，解析 `.jsonl` 格式的 Dumps 文件，清洗后写入 PostgreSQL 并同步到 Meilisearch。

**US-8: 链接健康检查**
> 作为一个运维人员，我希望系统定期检查 IPFS 链接的可用性，以便及时发现并标记失效资源。

示例：后台每日执行检测任务，对数据库中的 CID 向多个 IPFS 网关发送 HEAD 请求，更新可用状态。

## 6. 核心架构与模式

### 高级架构

采用 **BFF（Backend for Frontend）** 架构，前后端分离：

```
用户浏览器 (Vue3)
    │
    ▼
后端 API (FastAPI)
    │
    ├──▶ Meilisearch（全文搜索）
    ├──▶ PostgreSQL（元数据存储）
    └──▶ IPFS 网关健康检测模块

离线数据管道：
Dumps 文件 ──▶ ETL 脚本 ──▶ PostgreSQL ──▶ Meilisearch
```

### 目录结构

```
EasyBook/
├── backend/                # FastAPI 后端
│   ├── app/
│   │   ├── main.py         # 应用入口
│   │   ├── api/            # API 路由
│   │   ├── models/         # 数据模型
│   │   ├── services/       # 业务逻辑
│   │   └── config.py       # 配置管理
│   ├── etl/                # 数据导入脚本
│   │   ├── import_annas.py # Anna's Archive 导入
│   │   └── import_zlib.py  # Z-Library 导入
│   └── pyproject.toml
├── frontend/               # Vue3 前端
│   ├── src/
│   │   ├── App.vue
│   │   ├── views/          # 页面
│   │   ├── components/     # 组件
│   │   └── api/            # API 调用封装
│   └── package.json
├── docker-compose.yml      # 本地开发环境编排
└── rpiv/                   # 过程文档
```

### 关键设计模式

1. **内容寻址（Content-Addressed）下载** — 不存储文件本身，仅存储 IPFS CID/MD5 哈希，下载时动态拼接网关地址。只要 IPFS 网络中任一节点存有该文件，链接即有效
2. **离线索引 + 在线检索** — 数据通过离线 ETL 管道导入和清洗，搜索通过 Meilisearch 实时响应，两者解耦
3. **网关智能选优** — 后台持续检测多个 IPFS 公共网关的响应速度和可用性，下载时优先推荐最快的网关

## 7. 工具/功能

### F-1: 搜索功能

| 项目 | 说明 |
| --- | --- |
| **输入** | 关键词字符串（书名或作者） |
| **处理** | FastAPI 接收请求 → 调用 Meilisearch 全文检索 → 按相关度排序 |
| **输出** | 分页的搜索结果列表（书籍元数据 + 下载信息） |
| **搜索特性** | 模糊匹配、拼写容错、中文分词、简繁体兼容 |
| **结果合并** | 同一本书（基于书名+作者匹配）的不同格式合并为一条结果，每条结果下列出所有可用格式 |

### F-2: 下载链接生成

| 项目 | 说明 |
| --- | --- |
| **输入** | 书籍的 IPFS CID 或 MD5 + 文件格式 |
| **处理** | 后端查询网关健康状态 → 选择最优可用网关 → 拼接完整下载 URL |
| **输出** | 可直接访问的 IPFS 下载 URL |
| **URL 格式** | `https://{gateway}/ipfs/{CID}?filename={BookName}.{ext}` |
| **备用策略** | 如主网关不可用，按优先级依次提供备用网关链接 |

### F-3: ETL 数据导入

| 项目 | 说明 |
| --- | --- |
| **输入** | Anna's Archive / Z-Library 的元数据 Dumps 文件（`.jsonl` / SQL） |
| **清洗规则** | 仅保留 epub/pdf/mobi/azw3 格式；仅保留中文和英文记录；过滤无 MD5 条目（无 CID 仍导入）；基于 MD5 去重 |
| **中文处理** | 中文书名简繁体统一转换后索引 |
| **输出** | 数据写入 PostgreSQL + 同步到 Meilisearch 索引 |
| **执行方式** | 命令行脚本，支持增量导入 |

### F-4: IPFS 链接健康检查

| 项目 | 说明 |
| --- | --- |
| **检测方式** | 向多个 IPFS 公共网关发送 HEAD 请求 |
| **检测频率** | 每日执行一次（可配置） |
| **判断逻辑** | 单次不可达不立即标记失效，连续 N 次失败后标记（防止网关临时波动） |
| **输出** | 更新数据库中每个 CID 对应各网关的可用状态和响应时间 |
| **网关列表** | ipfs.io、dweb.link、gateway.pinata.cloud、4everland.io 等（可配置） |

## 8. 技术栈

### 后端

| 组件 | 技术 | 说明 |
| --- | --- | --- |
| Web 框架 | FastAPI (Python) | 异步高性能，适合搜索请求的高并发处理 |
| 搜索引擎 | Meilisearch | 开箱即用的中文分词支持，配置简单，适合中小数据量（<1亿条） |
| 数据库 | PostgreSQL | 存储书籍元数据，持久化数据 |
| 任务调度 | APScheduler 或 Celery Beat | IPFS 链接健康检查定时任务 |
| HTTP 客户端 | httpx | 异步 HTTP 请求（网关健康检查） |
| 中文处理 | OpenCC | 简繁体转换 |

### 前端

| 组件 | 技术 | 说明 |
| --- | --- | --- |
| 框架 | Vue 3 + Vite | 轻量快速，MVP 阶段开发效率高 |
| UI 组件库 | Naive UI 或 Element Plus | 快速搭建搜索界面 |
| HTTP 请求 | Axios | API 调用 |

### 基础设施

| 组件 | 技术 | 说明 |
| --- | --- | --- |
| 容器编排 | Docker Compose | 本地开发一键启动 Meilisearch + PostgreSQL |
| 包管理 | uv (Python) / pnpm (Node.js) | 项目依赖管理 |

## 9. 安全与配置

### 配置管理

通过环境变量管理所有配置项：

| 变量 | 说明 | 示例 |
| --- | --- | --- |
| `DATABASE_URL` | PostgreSQL 连接字符串 | `postgresql://user:pass@localhost:5432/easybook` |
| `MEILI_URL` | Meilisearch 地址 | `http://localhost:7700` |
| `MEILI_MASTER_KEY` | Meilisearch 管理密钥 | `your-master-key` |
| `IPFS_GATEWAYS` | IPFS 网关列表（逗号分隔） | `ipfs.io,dweb.link,gateway.pinata.cloud,4everland.io` |
| `HEALTH_CHECK_INTERVAL` | 健康检查间隔（小时） | `24` |
| `HEALTH_CHECK_FAIL_THRESHOLD` | 连续失败次数阈值 | `3` |

### 安全范围

- **范围内**：API 限流（防止搜索接口被滥用）、输入校验（防注入）
- **范围外**（MVP 不做）：用户认证授权、HTTPS 证书配置、WAF 防护

### 部署考虑

- MVP 阶段使用 Docker Compose 本地开发和测试
- 生产部署方案后续确定（VPS / 云服务器均可）

## 10. API 规范

### 搜索接口

**`GET /api/search`**

请求参数：

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | --- | --- |
| `q` | string | 是 | 搜索关键词 |
| `page` | int | 否 | 页码，默认 1 |
| `page_size` | int | 否 | 每页条数，默认 20，最大 100 |

响应示例：

```json
{
  "total": 156,
  "page": 1,
  "page_size": 20,
  "results": [
    {
      "id": "abc123",
      "title": "三体",
      "author": "刘慈欣",
      "formats": [
        {
          "extension": "epub",
          "filesize": 2415632,
          "download_url": "https://dweb.link/ipfs/bafykbz.../三体.epub"
        },
        {
          "extension": "pdf",
          "filesize": 5242880,
          "download_url": "https://dweb.link/ipfs/bafyabc.../三体.pdf"
        }
      ]
    }
  ]
}
```

### 下载链接接口

**`GET /api/download/{book_format_id}`**

返回最优 IPFS 网关的下载 URL，302 重定向或 JSON 返回链接。

响应示例：

```json
{
  "download_url": "https://dweb.link/ipfs/{CID}?filename={BookName}.epub",
  "gateway": "dweb.link",
  "alternatives": [
    "https://dweb.link/ipfs/{CID}?filename={BookName}.epub",
    "https://ipfs.io/ipfs/{CID}?filename={BookName}.epub"
  ]
}
```

### 健康状态接口（内部/运维用）

**`GET /api/health`**

返回系统健康状态（Meilisearch 连接、PostgreSQL 连接、最近一次健康检查时间）。

## 11. 成功标准

### MVP 成功定义

一个可以正常使用的电子书搜索平台，用户能通过关键词找到中文电子书并获得可用的下载链接。

### 功能要求

- ✅ 搜索响应时间 < 500ms（Meilisearch 查询）
- ✅ 搜索结果支持中文分词和模糊匹配
- ✅ 展示的下载链接中 ≥ 80% 经检测可用
- ✅ 数据库中导入 ≥ 10 万条中文电子书元数据
- ✅ 同一本书多格式正确合并展示

### 质量指标

- ETL 脚本可重复执行（幂等性），支持增量导入
- 后端 API 有基本的错误处理和日志记录
- 代码结构清晰，便于后续迭代扩展

### 用户体验目标

- 首页加载 < 2 秒
- 搜索交互路径：输入关键词 → 回车/点击 → 看到结果，不超过 2 步
- 下载交互路径：点击格式按钮 → 新窗口开始下载，不超过 1 步

## 12. 实施阶段

### Phase 1: 基础设施与数据管道

**目标**：搭建开发环境，跑通数据导入流程

**交付物：**
- ✅ Docker Compose 配置（PostgreSQL + Meilisearch）
- ✅ 数据库表结构创建脚本
- ✅ Anna's Archive Dumps 下载与解析脚本
- ✅ ETL 清洗脚本（格式过滤、去重、简繁体转换）
- ✅ 数据成功导入 PostgreSQL 并同步到 Meilisearch

**验证标准**：Meilisearch Dashboard 中可以搜索到导入的中文书籍数据。

### Phase 2: 后端 API 开发

**目标**：实现搜索和下载链接生成的核心 API

**交付物：**
- ✅ FastAPI 项目搭建（项目结构、配置管理）
- ✅ `/api/search` 搜索接口（对接 Meilisearch）
- ✅ `/api/download/{id}` 下载链接生成接口
- ✅ 搜索结果多格式合并逻辑
- ✅ IPFS 网关智能选优模块
- ✅ 基本的 API 限流和输入校验

**验证标准**：通过 curl / Postman 调用 API，搜索返回正确结果，下载链接可以正常跳转到 IPFS 网关。

### Phase 3: 前端界面

**目标**：实现用户可交互的搜索界面

**交付物：**
- ✅ Vue3 + Vite 项目搭建
- ✅ 搜索页面（搜索框 + 结果列表 + 分页）
- ✅ 搜索结果项组件（书名、作者、格式标签、下载按钮）
- ✅ 无结果提示
- ✅ 加载状态展示
- ✅ 前后端联调

**验证标准**：浏览器中完成完整的搜索 → 查看结果 → 点击下载流程。

### Phase 4: 健康检查与稳定性

**目标**：实现链接可用性检测，提升系统可靠性

**交付物：**
- ✅ IPFS 链接健康检查定时任务
- ✅ 网关响应速度记录与选优逻辑
- ✅ 失效链接标记（连续失败阈值机制）
- ✅ 系统健康状态 API
- ✅ 基本的运行日志和监控

**验证标准**：健康检查任务自动执行，失效链接被正确标记，下载时自动避开不可用网关。

## 13. 未来考虑

### 近期迭代（v1.1 - v1.3）

- 分类/标签浏览导航
- 多维度搜索筛选（ISBN、语言、格式、文件大小范围）
- 书籍详情页（封面图、简介信息）
- 用户反馈"链接失效"按钮
- 移动端响应式适配

### 中期增强

- 增量爬取：定期爬取已知电子书网站的新增资源
- 热门书籍 / 新书推荐
- 搜索历史（本地存储，无需登录）
- 多语言书籍支持

### 远期展望

- 用户账户体系（收藏、下载历史）
- 社区功能（资源提交、评价）
- 在线预览（PDF/EPUB 在线阅读器）
- API 开放给第三方应用接入

## 14. 风险与缓解措施

### 风险 1: IPFS 公共网关不稳定

- **影响**：用户点击下载后长时间无响应或下载失败
- **缓解**：预配置多个 IPFS 网关（≥5个），智能选优 + 自动切换备用网关；健康检查实时更新网关状态

### 风险 2: 数据源 Dumps 获取困难或格式变更

- **影响**：无法获取足够的电子书元数据，或 ETL 脚本解析失败
- **缓解**：支持多个数据源（Anna's Archive + Z-Library）；ETL 脚本模块化设计，每个数据源独立解析器，便于适配格式变化

### 风险 3: 中文搜索体验不佳

- **影响**：搜索结果不准确，用户找不到想要的书
- **缓解**：Meilisearch 内置中文分词支持；ETL 阶段做简繁体统一；搜索接口开启模糊匹配和拼写容错

### 风险 4: 数据量增长导致性能下降

- **影响**：随着导入数据增多，搜索变慢或系统资源不足
- **缓解**：Meilisearch 单机可支撑千万级文档；PostgreSQL 做好索引优化；架构上搜索和存储分离，可独立扩展

### 风险 5: 法律合规风险

- **影响**：平台可能面临版权相关的法律问题
- **缓解**：平台仅提供元数据索引和去中心化网络链接，不存储和分发任何文件；在页面添加免责声明；关注相关法律动态

## 15. 附录

### 参考文档

- 项目设计参考：`ebook_system_design.md`（项目根目录）

### 关键数据源

| 数据源 | 说明 | 获取方式 |
| --- | --- | --- |
| Anna's Archive Torrents | 最全的元数据聚合，包含 Z-Library、LibGen、Sci-Hub 数据，`.jsonl`/SQL 格式 | 官网 Datasets 页面下载种子 |
| Z-Library SQL Dumps | 历史归档元数据，包含大量中文书籍信息 | 社区渠道获取 |

### IPFS 公共网关参考列表

| 网关 | URL 模板 |
| --- | --- |
| IPFS.io | `https://ipfs.io/ipfs/{CID}` |
| dweb.link | `https://dweb.link/ipfs/{CID}` |
| Pinata | `https://gateway.pinata.cloud/ipfs/{CID}` |
| Filebase | `https://ipfs.filebase.io/ipfs/{CID}` |
| 4EVERLAND | `https://4everland.io/ipfs/{CID}` |
| W3S.link | `https://w3s.link/ipfs/{CID}` |
